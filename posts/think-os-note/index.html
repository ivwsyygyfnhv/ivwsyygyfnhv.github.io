<!DOCTYPE html>
<html lang="zh-cn">
	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		
		
		
		<meta name="generator" content="Hugo 0.26" />
		<title>《think os》笔记 &middot; 4 Fish</title>
		<link rel="shortcut icon" href="http://4fish.xyz/images/favicon.ico">
		<link rel="stylesheet" href="http://4fish.xyz/css/style.css">
		<link rel="stylesheet" href="http://4fish.xyz/css/highlight.css">

		
		<link rel="stylesheet" href="http://4fish.xyz/css/monosocialiconsfont.css">
		

		
		<link href="http://4fish.xyz/index.xml" rel="alternate" type="application/rss+xml" title="4 Fish" />
		

		
	</head>

    <body>
       <nav class="main-nav">
	
	
		<a href='http://4fish.xyz/'> <span class="arrow">←</span>Home</a>
	
	<a href='http://4fish.xyz/posts'>Archive</a>
	<a href='http://4fish.xyz/tags'>Tags</a>
	<a href='http://4fish.xyz/about'>About</a>

	

	
	<a class="cta" href="http://4fish.xyz/index.xml">Subscribe</a>
	
</nav>


        <section id="wrapper" class="post">
            <article>
                <header>
                    <h1>
                        《think os》笔记
                    </h1>
                    <h2 class="headline">
                    May 8, 2018 22:18
                    · 1912 words
                    · 4 minute read
                      <span class="tags">
                      
                      
                          
                              <a href="http://4fish.xyz/tags/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F">操作系统</a>
                          
                              <a href="http://4fish.xyz/tags/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0">读书笔记</a>
                          
                      
                      
                      </span>
                    </h2>
                </header>
                
                <section id="post-body">
                    

<h2 id="第一章-编译">第一章：编译</h2>

<ul>
<li>编译型语言和解释型语言</li>
<li>编译过程

<ul>
<li>1.预处理</li>
<li>2.解析</li>
<li>3.静态检查</li>
<li>4.生成机器/字节码</li>
<li>5.链接</li>
<li>6.优化</li>
</ul></li>
</ul>

<h2 id="第二章-进程">第二章：进程</h2>

<ul>
<li>进程：正在运行的程序。</li>
<li>进程包含的数据

<ul>
<li>程序的执行代码。</li>
<li>程序的数据，包括静态数据（编译期）和动态数据（栈，堆）。</li>
<li>IO状态。</li>
<li>硬件状态，包括寄存器中的数据，进程状态码，程序计数器（标示正在执行的指令）。</li>
</ul></li>
<li>实现进程隔离

<ul>
<li>多任务</li>
<li>虚拟内存</li>
<li>设备抽象</li>
</ul></li>
</ul>

<h2 id="第三章-虚拟内存">第三章：虚拟内存</h2>

<ul>
<li>32位系统的虚拟地址：0~2^32-1，64位系统的虚拟地址：0~2^64-1</li>

<li><p>进程的数据被组织为5个段（从低位到高位）</p>

<ul>
<li>代码段</li>
<li>static段</li>
<li>globals段</li>
<li>堆（从低位到高位增长）</li>
<li>栈（从高位到低位增长）
测试程序：
<code>c
#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
int global;
int main () {
	int local = 5;
void *p = malloc(128);
char *s = &quot;Hello, World&quot;;
printf (&quot;Address of main is %p\n&quot;, main);
printf (&quot;Address of global is %p\n&quot;, &amp;global);
printf (&quot;Address of local is %p\n&quot;, &amp;local);
printf (&quot;p points to %p\n&quot;, p);
printf (&quot;s points to %p\n&quot;, s);
}
</code></li>
</ul></li>

<li><p>虚拟地址和物理地址之间的转换通过MMU来进行。</p>

<ul>
<li>1.程序读取或写入一个变量时，CPU生成一个虚拟地址。</li>
<li>2.MMU把虚拟地址分成两块，分别是页号（page number）和偏移量（offset），一个页对应内存中的一段，页的大小通常为1～4KB。</li>
<li>3.MMU从TLB中查询页号，获取其对应的物理页号，通过物理页号和偏移量生成物理地址。</li>
</ul></li>

<li><p>假设操作系统是32位的，物理内存为1GB，分成1KB大小的页。</p>

<ul>
<li>因为1GB为2^30字节，一页大小为2^10字节，因此有2^20个物理页，也叫做帧。</li>
<li>虚拟地址空间为2^30字节，一页大小为2^10字节，因此有2^22个虚拟页。</li>
<li>偏移量的大小取决于页的大小，一页大小为2^10字节，因此需要10位来指定页中的一个字节。</li>
<li>如果VA为32位，偏移量位10位，剩余的22位指定了虚拟页号。</li>
<li>因为有2^20个物理页，每个物理页号由20位组成，加上10位的偏移量，最终的PA为30位。</li>
</ul></li>

<li><p>解决页表占用内存大：多级页表</p></li>
</ul>

<h2 id="第四章-文件与文件系统">第四章：文件与文件系统</h2>

<ul>
<li>文件的抽象性

<ul>
<li>“文件系统”是一个文件名称到其内容的映射表。</li>
<li>“文件”是一串字节的序列。</li>
</ul></li>
<li>文件和底层持久存储的区别：文件是基于字节的，持久存储是基于“块”的（一个块大小为1-8KB），对文件读写实际上是在对底层的块进行读写。</li>
<li>操作系统提供了一些特性，来弥补主存和硬盘之间的性能间隔：

<ul>
<li>传输块：从硬盘读取一个字节耗费5~25ms，相比之下，读取一个8KB的块所多耗费的时间可以忽略不计，因此系统在读硬盘时通常倾向读取大的块。</li>
<li>预读：当程序读取第一个块时，操作系统通常会同时读取更多的块。</li>
<li>缓冲：在写文件时，数据会被写入到缓存区（内存），至少有一个块需要写入时才会持久化到硬盘。</li>
</ul></li>
</ul>

<h2 id="第五章-字和字节">第五章：字和字节</h2>

<ul>
<li>&amp;运算：两个操作数都为1，结果为1，否则为0。</li>
<li>|运算：有一个操作数为1，结果为1，否则为0。</li>
<li>^运算：只有一个操作数为1，结果为1，否则为0。</li>
</ul>

<h2 id="第六章-内存管理">第六章：内存管理</h2>

<ul>
<li>内存分配函数：malloc，calloc，free，realloc。</li>
<li>malloc在运行时通常不依赖块的大小，但是可能取决于空闲块的数量。free通常很快，与空闲块的数量无关。calloc会清空块的每个字节，执行时间取决于块的大小和空闲数量，realloc执行时间取决于是否需要执行新旧内存块之间的复制。</li>
</ul>

<h2 id="第七章-缓存">第七章：缓存</h2>

<ul>
<li>程序数据的寄存器

<ul>
<li>程序计数器（PC），包含下一条指令在内存中的地址。</li>
<li>指令寄存器（IR），包含当前执行指令的机器码。</li>
<li>栈指针（SP），包含当前函数栈帧的指针，包括函数参数和局部变量。</li>
<li>状态寄存器。</li>
</ul></li>
<li>当CPU从内存读取数据时，它将一份副本存到缓冲中，缓存的命中率为h，缺失率为m，每次内存访问的平均时间为：<code>h * Th + m * Tm</code></li>
<li>局部性原理：CPU访问存储器时，无论是存取指令还是存取数据，所访问的存储单元都趋于聚集在一个较小的连续区域中。1.重复引用同一个变量具有良好的时间局部性。 2.对于步长位k的引用程序，步长越小，空间局部性越小。步长为1的引用具有良好的空间局部性。k越大，空间局部性越差。</li>
</ul>

<h2 id="第八章-多任务">第八章：多任务</h2>

<ul>
<li>中断：中断是一个事件，它会停止通常的指令周期，并且使执行流跳到中断处理器的特殊代码区域内。</li>
<li>硬件中断：硬件设备-&gt;CPU，软件中断：程序-&gt;内核。</li>
<li>系统调用：执行特殊的指令触发中断，使程序流跳到内核中，内核读取系统调用的请求参数，执行操作，之后恢复中断进程的执行。</li>
<li>进程的生命周期：运行，就绪，阻塞，终止。

<ul>
<li>进程被启动或恢复：就绪-&gt;运行。</li>
<li>进程被中断：运行-&gt;就绪。</li>
<li>进程执行不能立即完成的系统调用：运行-&gt;阻塞。</li>
<li>进程阻塞操作完成：阻塞-&gt;就绪。</li>
<li>进程退出：终止。</li>
</ul></li>
<li>调度器运行时会优先调度优先级最高的进程。</li>
</ul>

<h2 id="第九章-线程">第九章：线程</h2>

<ul>
<li>同一进程中的所有线程共享相同的代码段，static段，堆，但每个线程拥有属于自己的栈，线程不能访问其它线程的局部变量。</li>
</ul>

                </section>
            </article>

            

            

            

            <footer id="footer">
    
    <p class="small">
    
       © Copyright 2018 <i class="fa fa-heart" aria-hidden="true"></i> 
    
    </p>
    <p class="small">
        Powered by <a href="http://www.gohugo.io/">Hugo</a> Theme By <a href="https://github.com/nodejh/hugo-theme-cactus-plus">nodejh</a>
    </p>
</footer>

        </section>

        <script src="http://4fish.xyz/js/jquery-3.3.1.min.js"></script>
<script src="http://4fish.xyz/js/main.js"></script>
<script src="http://4fish.xyz/js/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad();</script>




  
<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-117516487-1', 'auto');
ga('send', 'pageview');
</script>





    </body>
</html>
